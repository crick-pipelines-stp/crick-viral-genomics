process {
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0].toLowerCase()}" },
        mode: "${params.publish_dir_mode}",
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]
}

process {
    // withName: 'BWA_ALIGN_HOST' {

    // }

    withName: 'BAM_HOST_SORT_STATS:SAMTOOLS_SORT' {
        ext.prefix = { "${meta.id}.host.sorted" }
        // publishDir = [
        //     path: { "${params.outdir}/02_alignment/${params.aligner}/target" },
        //     mode: "${params.publish_dir_mode}",
        //     pattern: "*.bam",
        //     enabled: ( params.save_align_intermed || (!params.run_read_filter && !params.run_mark_dups && !params.run_remove_dups) )
        // ]
    }

    withName: 'BAM_HOST_SORT_STATS:SAMTOOLS_INDEX' {
        ext.prefix = { "${meta.id}.host.sorted" }
        // publishDir = [
        //     path: { "${params.outdir}/02_alignment/${params.aligner}/target" },
        //     mode: "${params.publish_dir_mode}",
        //     pattern: "*.bai",
        // ]
    }

     withName: 'BAM_HOST_SORT_STATS:BAM_STATS_SAMTOOLS:.*' {
        ext.prefix = { "${meta.id}.host" }
            // publishDir = [
            //     path: { "${params.outdir}/02_alignment/${params.aligner}/target" },
            //     mode: "${params.publish_dir_mode}",
            //     pattern: "*.{stats,flagstat,idxstats}",
            //     enabled: ( params.save_align_intermed || (!params.run_read_filter && !params.run_mark_dups && !params.run_remove_dups) )
            // ]
    }




    withName: 'SPADES_ASSEMBLE' {
        ext.args = "--only-assembler"
        // publishDir = [
        //     path: { "${params.outdir}/dorado/basecaller" },
        //     mode: "${params.publish_dir_mode}",
        //     saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
        // ]
    }
}